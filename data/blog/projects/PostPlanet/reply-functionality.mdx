---
title: Reply Functionality
date: '2024-04-09'
tags: ['project', 'Next.js', 'server actions', 'PostPlanet']
draft: false
summary: ë‹µê¸€ ë‹¬ê¸°
---

ì½˜í…ì¸ ë¥¼ ê²Œì‹œí•˜ëŠ” ê²ƒê³¼ ë§ˆì°¬ê°€ì§€ë¡œ ì»´í¬ë„ŒíŠ¸ `<PostForm />`ì„ ì‚¬ìš©í•˜ì§€ë§Œ, ì„œë²„ ì•¡ì…˜ì´ ë‹¬ë¼ì§„ë‹¤.

```ts:actions/reply.action.ts
'use server';

import db from '@/lib/db';
import { revalidatePath } from 'next/cache';
import { readPost } from './post.actions';
import { Post } from '@prisma/client';

export async function replyToPost(
  prevState: {
    message: string;
  },
  formData: FormData
) {
  const image = formData.get('fileUrl') as string;
  let text = formData.get('text') as string;
  text = text.trim();
  const userId = formData.get('userId') as string;

  if (!text && !image)
    return {
      message: "There's nothing to reply ğŸ˜¢",
    };

  const postId = formData.get('postId') as string;
  const { authorId, text: postText } = (await readPost(postId)) as Post;

  try {
    await db.reply.create({
      data: {
        text,
        image,
        author: {
          connect: {
            id: userId,
          },
        },
        post: {
          connect: {
            id: postId,
          },
        },
      },
    });

  await db.activity.create({
    data: {
      type: 'reply',
      giverId: userId,
      receiverId: authorId,
      postId,
      text: postText,
    },
  });

  revalidatePath('/', 'layout');

    return {
      message: 'Success',
    };
  } catch (error: any) {
    return {
      message: 'Failed to reply ğŸ˜¢',
    };
  }
}
```