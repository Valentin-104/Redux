---
title: NextAuth.js
date: '2023-02-09'
tags: ['NextAuth.js', 'Next.js', 'auth' ,'OAuth']
draft: false
summary: NextAuth.jsë¥¼ í™œìš©í•œ Open Authorization
---

- Next.jsì—ì„œ authë¥¼ êµ¬í˜„í•˜ê¸° ìœ„í•œ open source libraryì¸ NextAuth.jsë¥¼ í™œìš©í•´ë³´ì•˜ë‹¤.

  > [NextAuth.js](https://next-auth.js.org/)

- ê³µì‹ í™ˆí˜ì´ì§€ì— ë“¤ì–´ê°€ë³´ë©´ ë°”ë¡œ ì½”ë“œê°€ ë‚˜ì™€ìˆë‹¤. í¬ê²Œ 3ê°€ì§€ ë‹¨ê³„ë¡œ ë‚˜ë‰œë‹¤.

1. ë¨¼ì € `/pages/api/auth` í´ë”ë¡œ ê°€ì„œ `[...nextauth].ts` ë¼ëŠ” íŒŒì¼ì„ ë§Œë“¤ê³ , ì›í•˜ëŠ” OAuth providerë¥¼ ê³¨ë¼ ì½”ë“œë¥¼ ì‘ì„±í•œë‹¤. 
    
    
    ```ts:pages/api/auth/[...nextauth].ts
    import NextAuth from 'next-auth'
    import AppleProvider from 'next-auth/providers/apple'
    import FacebookProvider from 'next-auth/providers/facebook'
    import GoogleProvider from 'next-auth/providers/google'
    import EmailProvider from 'next-auth/providers/email'
    
    export default NextAuth({
      providers: [
        // OAuth authentication providers...
        AppleProvider({
          clientId: process.env.APPLE_ID,
          clientSecret: process.env.APPLE_SECRET
        }),
        FacebookProvider({
          clientId: process.env.FACEBOOK_ID,
          clientSecret: process.env.FACEBOOK_SECRET
        }),
        GoogleProvider({
          clientId: process.env.GOOGLE_ID,
          clientSecret: process.env.GOOGLE_SECRET
        }),
        // Passwordless / email sign in
        EmailProvider({
          server: process.env.MAIL_SERVER,
          from: 'NextAuth.js <no-reply@example.com>'
        }),
      ]
    })
    ```
    
    ë‚˜ëŠ” googleë¡œë§Œ OAuthë¥¼ ì§„í–‰í•˜ê³  ì‹¶ì—ˆë‹¤.
    
    ```ts:pages/api/auth/[...nextauth].ts
    import NextAuth from 'next-auth';
    import GoogleProvider from 'next-auth/providers/google';
    
    export default NextAuth({
      providers: [
        GoogleProvider({
          clientId: process.env.GOOGLE_ID!,
          clientSecret: process.env.GOOGLE_SECRET!,
        }),
      ],
    });
    ```
    
    ì—¬ê¸°ì„œ `GOOGLE_ID`ì™€ `GOOGLE_SECRET`ì€ êµ¬ê¸€ í´ë¼ìš°ë“œì—ì„œ ì›¹ ì•±ì„ ë§Œë“  í›„, API ë° ì„œë¹„ìŠ¤ > ì‚¬ìš©ì ì¸ì¦ ì •ë³´ > OAuth 2.0 í´ë¼ì´ì–¸íŠ¸ IDë¡œ ê°€ë©´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

    > [Cloud Computing Services](https://cloud.google.com/)

2. `/pages/_app.tsx` ë¡œ ê°€ì„œ `<Component>` ë¥¼ `<SessionProvider>` ë¡œ ê°ì‹¸ì£¼ì–´ auth contextë¥¼ ì„¤ì •í•œë‹¤. 
    
    ```tsx:pages/_app.tsx
    import '@/styles/globals.css';
    import type { AppProps } from 'next/app';
    import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
    import { RecoilRoot } from 'recoil';
    import { SessionProvider } from 'next-auth/react';
    
    const queryClient = new QueryClient();
    
    export default function App({
      Component,
      pageProps: { session, ...pageProps },
    }: AppProps) {
      return (
        <SessionProvider session={session}>
          <RecoilRoot>
            <QueryClientProvider client={queryClient}>
              <Component {...pageProps} />
            </QueryClientProvider>
          </RecoilRoot>
        </SessionProvider>
      );
    }
    ```
    
3. ì´ì œ ìì‹ ì´ ì›í•˜ëŠ” í˜ì´ì§€ì—ì„œ `useSession()` hookì„ í†µí•´ sessionì„ ì´ìš©í•˜ê³ , `signIn` , `signOut`  methodë¥¼ í†µí•´ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒì„ í•  ìˆ˜ ìˆë‹¤. 
   
    ```tsx:pages/index.tsx

    import { useSession, signIn, signOut } from "next-auth/react"
    
    export default function Home() {
      const { status, data: session } = useSession();
    
      if (status === 'loading') return <Loader />; // ë¡œë”©ì¤‘
    
      if (status === 'authenticated') // ë¡œê·¸ì¸ ìƒíƒœ
        return (
          <>
            <Head>
              <title>Create Next App</title>
              <meta name='description' content='Generated by create next app' />
              <meta name='viewport' content='width=device-width, initial-scale=1' />
              <link rel='icon' href='/favicon.ico' />
            </Head>
            <main>
    	        Signed in as {session.user.email} <br/>
    			    <button onClick={() => signOut()}>Sign out</button>
            </main>
          </>
        );
    	
        // ë¡œê·¸ì•„ì›ƒ ìƒíƒœ
        return (
          <button onClick={() => signIn('google')} className='bg-white'>
            Sign in
          </button>
        );
    }
    ```
    
4. ì´ë ‡ê²Œ í•˜ê³  ë¡œê·¸ì¸ì„ ì‹œë„í–ˆë”ë‹ˆ ì´ëŸ° í˜ì´ì§€ë¡œ ë¦¬ë””ë ‰íŠ¸ë˜ì—ˆë‹¤. 

    ![error](/static/images/error.png)
  

    ì´ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ì„œ, error detailsë¥¼ í´ë¦­í•´ë´¤ë‹¤. ê·¸ë¬ë”ë‹ˆ ì´ëŸ° ì°½ì´ ë–´ë‹¤.

    ![redirect_uri_mismatch](/static/images/redirect_uri_mismatch.png)

    ë‚´ìš©ì¸ ì¦‰ìŠ¨, ì•„ê¹Œ ì•±ì„ ë§Œë“¤ì—ˆë˜ êµ¬ê¸€ í´ë¼ìš°ë“œë¡œ ê°€ì„œ redirect urië¥¼ ë“±ë¡í•˜ë¼ëŠ” ê²ƒì´ë‹¤. `http://localhost:3000/api/auth/callback/google`ë¡œ ë“±ë¡í•˜ì˜€ë‹¤. 

5. í•´ê²°ëë‹¤!! ğŸ‘ğŸ‘ğŸ‰ğŸ‰
    
    ![success](/static/images/success.png)